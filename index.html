<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<title>SHM Web Simulator тАФ р╕Зр╣Ир╕▓р╕вр╕кр╕╕р╕Ф (Form UI)</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:18px;background:#f7f9fb;color:#111}
  h1{margin-bottom:6px}
  .box{background:white;padding:12px;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,0.08);margin-bottom:14px}
  h3{margin-top:0}
  label{display:inline-block;width:140px;font-weight:bold;font-size:0.9em}
  input[type="number"], input[type="text"]{width:70px;padding:4px;border:1px solid #ddd;border-radius:4px;margin-right:4px}
  input[type="checkbox"]{width:auto;margin-left:4px}
  button{padding:8px 12px;margin:4px;background:#1677ff;color:white;border:none;border-radius:6px;cursor:pointer}
  button:hover{background:#0d5eff}
  .state-row{margin-bottom:12px;padding:10px;border:1px solid #e6eef6;border-radius:6px;background:#f9fcff}
  .state-row h4{margin:0 0 8px 0;font-size:1.1em}
  .vars-container{display:flex;flex-wrap:wrap}
  .var-group{display:inline-block;margin:4px 6px;vertical-align:top;min-width:160px}
  .warning{color:#b91c1c;font-weight:700}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  td,th{border:1px solid #e6eef6;padding:6px;text-align:left}
  th{background:#f0f8ff}
  #result, #plots{display:none}
  #plots .plot-div{height:360px;margin-top:12px}
  select{width:120px;padding:4px}
  .hidden{display:none !important}
</style>
</head>
<body>
  <h1>SHM Web Simulator тАФ р╕Зр╣Ир╕▓р╕вр╕кр╕╕р╕Ф (Form UI)</h1>

  <div class="box">
    <h3>ЁЯУШ р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ (р╕кр╕гр╕╕р╕Ы)</h3>
    <p>1. р╣Ар╕ер╕╖р╕нр╕Б <b>р╕гр╕░р╕Ър╕Ъ</b> (р╕кр╕Ыр╕гр╕┤р╕З р╕лр╕гр╕╖р╕н р╕ер╕╣р╕Бр╕Хр╕╕р╣Йр╕б) тАФ р╕Кр╣Ир╕нр╕З input р╕Ър╕▓р╕Зр╕Кр╣Ир╕нр╕Зр╕Ир╕░р╕Лр╣Ир╕нр╕Щ/р╣Вр╕Кр╕зр╣Мр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ (р╣Ар╕Кр╣Ир╕Щ k р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕Ыр╕гр╕┤р╕З, L р╕кр╕│р╕лр╕гр╕▒р╕Ър╕ер╕╣р╕Бр╕Хр╕╕р╣Йр╕б).<br>
    2. р╣Ар╕ер╕╖р╕нр╕Б <b>р╕Ир╕│р╕Щр╕зр╕Щр╕кр╕ар╕▓р╕зр╕░</b> (1-4) тАФ р╕Ир╕░р╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕Цр╕з input р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤.<br>
    3. р╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░р╕кр╕ар╕▓р╕зр╕░: р╣Гр╕кр╣Ир╕Хр╕▒р╕зр╣Ар╕ер╕Вр╣Гр╕Щр╕Кр╣Ир╕нр╕Зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г (р╕лр╕Щр╣Ир╕зр╕в: m=kg, k=N/m, L=m, g=m/s┬▓, x=m, v=m/s, etc.). р╕Цр╣Йр╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г <b>р╕Др╕Зр╕Др╣Ир╕▓р╕Ир╕▓р╕Бр╕кр╕ар╕▓р╕зр╕░р╕Бр╣Ир╕нр╕Щ (=)</b> р╣Гр╕лр╣Йр╕Хр╕┤р╣Кр╕Б checkbox р╕Вр╣Йр╕▓р╕Зр╕Кр╣Ир╕нр╕Зр╕Щр╕▒р╣Йр╕Щ (input р╕Ир╕░р╕Бр╕ер╕▓р╕вр╣Ар╕Ыр╣Зр╕Щ "=" р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤).<br>
    4. р╕Бр╕Ф <b>р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З</b> р╣Ар╕Юр╕╖р╣Ир╕нр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╕Щр╕Чр╕╡ + р╕Др╕│р╕Щр╕зр╕У.<br>
    5. р╕Бр╕Ф <b>р╕Др╕│р╕Щр╕зр╕У</b> тАФ р╕Ьр╕ер╕Ир╕░р╣Вр╕Кр╕зр╣Мр╕Хр╕▓р╕гр╕▓р╕З, р╕Др╕│р╣Ар╕Хр╕╖р╕нр╕Щ (р╕Цр╣Йр╕▓р╕бр╕╡), р╕кр╕╣р╕Хр╕гр╕нр╕Шр╕┤р╕Ър╕▓р╕в, р╣Бр╕ер╕░р╕Бр╕гр╕▓р╕Я (р╕Цр╣Йр╕▓р╕бр╕╡ ╧Й р╣Бр╕ер╕░ A).</p>
    <details>
      <summary>ЁЯФН р╕кр╕╣р╕Хр╕гр╕кр╕│р╕Др╕▒р╕Нр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Др╕ер╕┤р╕Бр╣Ар╕Юр╕╖р╣Ир╕нр╕Вр╕вр╕▓р╕в)</summary>
      <pre>
р╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ:
  ╧Й = 2╧А f = 2╧А / T
  f = 1 / T
  a = -╧Й┬▓ x

р╕кр╕Ыр╕гр╕┤р╕З:
  ╧Й = тИЪ(k/m)
  T = 2╧А тИЪ(m/k)
  ╬гF (equilibrium) = k x = m g

р╕ер╕╣р╕Бр╕Хр╕╕р╣Йр╕б (small-angle):
  ╧Й = тИЪ(g/L)
  T = 2╧А тИЪ(L/g)

р╕Бр╕▓р╕гр╕Бр╕гр╕░р╕Ир╕▒р╕Фр╕Хр╕▓р╕бр╣Ар╕зр╕ер╕▓:
  x(t) = A cos(╧Й t + ╧Ж)  р╕лр╕гр╕╖р╕н x(t) = A sin(╧Й t + ╧Ж)

р╕Др╕зр╕▓р╕бр╣Ар╕гр╣Зр╕з/р╕Др╕зр╕▓р╕бр╣Ар╕гр╣Ир╕З:
  v = ┬▒ ╧Й тИЪ(A┬▓ - x┬▓)
  a = -╧Й┬▓ x
  Vmax = ╧Й A
  a_max = ╧Й┬▓ A

р╕Юр╕ер╕▒р╕Зр╕Зр╕▓р╕Щ:
  KE = ┬╜ m v┬▓ = ┬╜ m ╧Й┬▓ (A┬▓ - x┬▓)
  PE = ┬╜ k x┬▓ = ┬╜ m ╧Й┬▓ x┬▓
  E_total = ┬╜ k A┬▓ = ┬╜ m ╧Й┬▓ A┬▓
      </pre>
    </details>
  </div>

  <div class="box">
    <h3>ЁЯФз р╕Хр╕▒р╕зр╕Кр╣Ир╕зр╕в (Wizard) тАФ р╕Др╕ер╕┤р╕Бр╣Ар╕Юр╕╖р╣Ир╕нр╣Вр╕лр╕ер╕Фр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З</h3>
    <button onclick="loadExample('spring1')">р╕кр╕Ыр╕гр╕┤р╕З: m=2kg тЖТ m=0.5kg (x р╕Др╕З)</button>
    <button onclick="loadExample('spring2')">р╕кр╕Ыр╕гр╕┤р╕З: m=0.05kg, x_eq=0.02m, A=0.025m</button>
    <button onclick="loadExample('pendulum1')">р╕ер╕╣р╕Бр╕Хр╕╕р╣Йр╕б: L=2m, T=2.5s тЖТ L=8m</button>
    <button onclick="clearAll()">р╕ер╣Йр╕▓р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</button>
  </div>

  <div class="box">
    <h3>ЁЯУЭ р╣Гр╕кр╣Ир╕Вр╣Йр╕нр╕бр╕╣р╕е (Form р╕Зр╣Ир╕▓р╕в р╣Ж)</h3>
    <div>
      <label>р╕гр╕░р╕Ър╕Ъ:</label>
      <select id="system" onchange="updateVisibility()">
        <option value="spring">р╕кр╕Ыр╕гр╕┤р╕З (Spring)</option>
        <option value="pendulum">р╕ер╕╣р╕Бр╕Хр╕╕р╣Йр╕б (Pendulum)</option>
      </select>
    </div>
    <div style="margin:12px 0">
      <label>р╕Ир╕│р╕Щр╕зр╕Щр╕кр╕ар╕▓р╕зр╕░:</label>
      <select id="numStates" onchange="generateStates()">
        <option value="1">1</option>
        <option value="2" selected>2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
      <button onclick="addState()">р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕ар╕▓р╕зр╕░</button>
      <button onclick="removeLastState()">р╕ер╕Ър╕кр╕ар╕▓р╕зр╕░р╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в</button>
    </div>
    <div id="statesContainer"></div>
    <br>
    <button onclick="calculate()">р╕Др╕│р╕Щр╕зр╕У</button>
    <button onclick="exportJson()">Export р╣Ар╕Ыр╣Зр╕Щ JSON (р╕Фр╕╣р╣Вр╕Др╣Йр╕Ф)</button>
  </div>

  <div id="result" class="box"></div>
  <div id="plots" class="box"></div>

<script>
let currentNumStates = 2;
const varLabels = {
  m: 'р╕бр╕зр╕е m (kg)', k: 'р╕кр╕Ыр╕гр╕┤р╕З k (N/m)', L: 'р╕Др╕зр╕▓р╕бр╕вр╕▓р╕з L (m)', g: 'р╣Бр╕гр╕Зр╣Вр╕Щр╣Йр╕бр╕Цр╣Ир╕зр╕З g (m/s┬▓)',
  sigmaF: '╬гF (N)', x: 'р╕Бр╕▓р╕гр╕Бр╕гр╕░р╕Ир╕▒р╕Ф x (m)', v: 'р╕Др╕зр╕▓р╕бр╣Ар╕гр╣Зр╕з v (m/s)', Vmax: 'V_max (m/s)',
  a_max: 'a_max (m/s┬▓)', a: 'р╕Др╕зр╕▓р╕бр╣Ар╕гр╣Ир╕З a (m/s┬▓)', KE: 'KE (J)', PE: 'PE (J)',
  E: 'р╕Юр╕ер╕▒р╕Зр╕Зр╕▓р╕Щр╕гр╕зр╕б E (J)', A: 'р╣Бр╕нр╕бр╕Юр╕ер╕┤р╕Ир╕╣р╕Ф A (m)', omega: '╧Й (rad/s)',
  f: 'р╕Др╕зр╕▓р╕бр╕Цр╕╡р╣И f (Hz)', T: 'р╕гр╕нр╕Ъ T (s)'
};
const allVars = ['m','k','L','g','sigmaF','x','v','Vmax','a_max','a','KE','PE','E','A','omega','f','T'];

function generateStates() {
  const num = parseInt(document.getElementById('numStates').value);
  currentNumStates = num;
  const container = document.getElementById('statesContainer');
  container.innerHTML = '';
  console.log(`Generating ${num} states...`);
  for (let i = 0; i < num; i++) {
    const row = createStateRow(i + 1);
    container.appendChild(row);
  }
  updateVisibility();
}

function createStateRow(index) {
  const div = document.createElement('div');
  div.className = 'state-row';
  div.innerHTML = `<h4>р╕кр╕ар╕▓р╕зр╕░ ${index}</h4><div class="vars-container"></div>`;
  const varsContainer = div.querySelector('.vars-container');
  allVars.forEach(key => {
    const group = document.createElement('div');
    group.className = 'var-group';
    const label = document.createElement('label');
    label.textContent = varLabels[key] || key;
    const input = document.createElement('input');
    input.type = 'number';
    input.id = `state${index}_${key}`;
    input.step = 'any';
    input.value = '';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = `eq${index}_${key}`;
    checkbox.onchange = function() {
      if (this.checked) {
        input.value = '=';
        input.disabled = true;
      } else {
        input.value = '';
        input.disabled = false;
      }
    };
    input.oninput = function() {
      const eq = document.getElementById(`eq${index}_${key}`);
      if (this.value !== '' && this.value !== '=') {
        eq.checked = false;
      }
    };
    group.appendChild(label);
    group.appendChild(input);
    group.appendChild(checkbox);
    varsContainer.appendChild(group);
  });
  return div;
}

function updateVisibility() {
  const system = document.getElementById('system').value;
  const isSpring = system === 'spring';
  console.log(`Updating visibility for ${system}`);
  allVars.forEach(key => {
    for (let i = 1; i <= currentNumStates; i++) {
      const input = document.getElementById(`state${i}_${key}`);
      const group = input ? input.parentElement : null;
      if (group) {
        if ((key === 'k' && !isSpring) || (key === 'L' && isSpring)) {
          group.classList.add('hidden');
        } else {
          group.classList.remove('hidden');
        }
      }
    }
  });
}

function loadExample(name) {
  console.log(`Loading example: ${name}`);
  let system, numStates, values;
  if (name === 'spring1') {
    system = 'spring'; numStates = 2;
    values = [
      {m: 2, x: 0.1, g: 9.81},
      {m: 0.5, x: '='}
    ];
  } else if (name === 'spring2') {
    system = 'spring'; numStates = 2;
    values = [
      {m: 0.05, x: 0.02, g: 9.81},
      {m: '=', A: 0.025, x: 0}
    ];
  } else {
    system = 'pendulum'; numStates = 2;
    values = [
      {L: 2, T: 2.5, g: 9.81},
      {L: 8, T: '='}
    ];
  }
  document.getElementById('system').value = system;
  document.getElementBy
