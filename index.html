<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<title>SHM Web Simulator ‚Äî ‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î (Form UI)</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:18px;background:#f7f9fb;color:#111}
  h1{margin-bottom:6px}
  .box{background:white;padding:12px;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,0.08);margin-bottom:14px}
  h3{margin-top:0}
  label{display:inline-block;width:140px;font-weight:bold;font-size:0.9em}
  input[type="number"], input[type="text"]{width:70px;padding:4px;border:1px solid #ddd;border-radius:4px;margin-right:4px}
  input[type="checkbox"]{width:auto;margin-left:4px}
  button{padding:8px 12px;margin:4px;background:#1677ff;color:white;border:none;border-radius:6px;cursor:pointer}
  button:hover{background:#0d5eff}
  .state-row{margin-bottom:12px;padding:10px;border:1px solid #e6eef6;border-radius:6px;background:#f9fcff}
  .state-row h4{margin:0 0 8px 0;font-size:1.1em}
  .vars-container{display:flex;flex-wrap:wrap}
  .var-group{display:inline-block;margin:4px 6px;vertical-align:top;min-width:160px}
  .warning{color:#b91c1c;font-weight:700}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  td,th{border:1px solid #e6eef6;padding:6px;text-align:left}
  th{background:#f0f8ff}
  #result, #plots{display:none}
  #plots .plot-div{height:360px;margin-top:12px}
  select{width:120px;padding:4px}
  .hidden{display:none !important}
</style>
</head>
<body>
  <h1>SHM Web Simulator ‚Äî ‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î (Form UI)</h1>

  <div class="box">
    <h3>üìò ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏™‡∏£‡∏∏‡∏õ)</h3>
    <p>1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>‡∏£‡∏∞‡∏ö‡∏ö</b> (‡∏™‡∏õ‡∏£‡∏¥‡∏á ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏π‡∏Å‡∏ï‡∏∏‡πâ‡∏°) ‚Äî ‡∏ä‡πà‡∏≠‡∏á input ‡∏ö‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô/‡πÇ‡∏ä‡∏ß‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô k ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏õ‡∏£‡∏¥‡∏á, L ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏ï‡∏∏‡πâ‡∏°).<br>
    2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏†‡∏≤‡∏ß‡∏∞</b> (1-4) ‚Äî ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß input ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥.<br>
    3. ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏†‡∏≤‡∏ß‡∏∞: ‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏´‡∏ô‡πà‡∏ß‡∏¢: m=kg, k=N/m, L=m, g=m/s¬≤, x=m, v=m/s, etc.). ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ <b>‡∏Ñ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡∏†‡∏≤‡∏ß‡∏∞‡∏Å‡πà‡∏≠‡∏ô (=)</b> ‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡πä‡∏Å checkbox ‡∏Ç‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏±‡πâ‡∏ô (input ‡∏à‡∏∞‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô "=" ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥).<br>
    4. ‡∏Å‡∏î <b>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ + ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì.<br>
    5. ‡∏Å‡∏î <b>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</b> ‚Äî ‡∏ú‡∏•‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á, ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ), ‡∏™‡∏π‡∏ï‡∏£‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢, ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ œâ ‡πÅ‡∏•‡∏∞ A).</p>
    <details>
      <summary>üîç ‡∏™‡∏π‡∏ï‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢)</summary>
      <pre>
‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô:
  œâ = 2œÄ f = 2œÄ / T
  f = 1 / T
  a = -œâ¬≤ x

‡∏™‡∏õ‡∏£‡∏¥‡∏á:
  œâ = ‚àö(k/m)
  T = 2œÄ ‚àö(m/k)
  Œ£F (equilibrium) = k x = m g

‡∏•‡∏π‡∏Å‡∏ï‡∏∏‡πâ‡∏° (small-angle):
  œâ = ‚àö(g/L)
  T = 2œÄ ‚àö(L/g)

‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤:
  x(t) = A cos(œâ t + œÜ)  ‡∏´‡∏£‡∏∑‡∏≠ x(t) = A sin(œâ t + œÜ)

‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß/‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á:
  v = ¬± œâ ‚àö(A¬≤ - x¬≤)
  a = -œâ¬≤ x
  Vmax = œâ A
  a_max = œâ¬≤ A

‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô:
  KE = ¬Ω m v¬≤ = ¬Ω m œâ¬≤ (A¬≤ - x¬≤)
  PE = ¬Ω k x¬≤ = ¬Ω m œâ¬≤ x¬≤
  E_total = ¬Ω k A¬≤ = ¬Ω m œâ¬≤ A¬≤
      </pre>
    </details>
  </div>

  <div class="box">
    <h3>üîß ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ (Wizard) ‚Äî ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</h3>
    <button onclick="loadExample('spring1')">‡∏™‡∏õ‡∏£‡∏¥‡∏á: m=2kg ‚Üí m=0.5kg (x ‡∏Ñ‡∏á)</button>
    <button onclick="loadExample('spring2')">‡∏™‡∏õ‡∏£‡∏¥‡∏á: m=0.05kg, x_eq=0.02m, A=0.025m</button>
    <button onclick="loadExample('pendulum1')">‡∏•‡∏π‡∏Å‡∏ï‡∏∏‡πâ‡∏°: L=2m, T=2.5s ‚Üí L=8m</button>
    <button onclick="clearAll()">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  </div>

  <div class="box">
    <h3>üìù ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Form ‡∏á‡πà‡∏≤‡∏¢ ‡πÜ)</h3>
    <div>
      <label>‡∏£‡∏∞‡∏ö‡∏ö:</label>
      <select id="system" onchange="updateVisibility()">
        <option value="spring">‡∏™‡∏õ‡∏£‡∏¥‡∏á (Spring)</option>
        <option value="pendulum">‡∏•‡∏π‡∏Å‡∏ï‡∏∏‡πâ‡∏° (Pendulum)</option>
      </select>
    </div>
    <div style="margin:12px 0">
      <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏†‡∏≤‡∏ß‡∏∞:</label>
      <select id="numStates" onchange="generateStates()">
        <option value="1">1</option>
        <option value="2" selected>2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
      <button onclick="addState()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏†‡∏≤‡∏ß‡∏∞</button>
      <button onclick="removeLastState()">‡∏•‡∏ö‡∏™‡∏†‡∏≤‡∏ß‡∏∞‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</button>
    </div>
    <div id="statesContainer"></div>
    <br>
    <button onclick="calculate()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
    <button onclick="exportJson()">Export ‡πÄ‡∏õ‡πá‡∏ô JSON (‡∏î‡∏π‡πÇ‡∏Ñ‡πâ‡∏î)</button>
  </div>

  <div id="result" class="box"></div>
  <div id="plots" class="box"></div>

<script>
let currentNumStates = 2;
const varLabels = {
  m: '‡∏°‡∏ß‡∏• m (kg)', k: '‡∏™‡∏õ‡∏£‡∏¥‡∏á k (N/m)', L: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß L (m)', g: '‡πÅ‡∏£‡∏á‡πÇ‡∏ô‡πâ‡∏°‡∏ñ‡πà‡∏ß‡∏á g (m/s¬≤)',
  sigmaF: 'Œ£F (N)', x: '‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏±‡∏î x (m)', v: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß v (m/s)', Vmax: 'V_max (m/s)',
  a_max: 'a_max (m/s¬≤)', a: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á a (m/s¬≤)', KE: 'KE (J)', PE: 'PE (J)',
  E: '‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏° E (J)', A: '‡πÅ‡∏≠‡∏°‡∏û‡∏•‡∏¥‡∏à‡∏π‡∏î A (m)', omega: 'œâ (rad/s)',
  f: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà f (Hz)', T: '‡∏£‡∏≠‡∏ö T (s)'
};
const allVars = ['m','k','L','g','sigmaF','x','v','Vmax','a_max','a','KE','PE','E','A','omega','f','T'];

function generateStates() {
  const num = parseInt(document.getElementById('numStates').value);
  currentNumStates = num;
  const container = document.getElementById('statesContainer');
  container.innerHTML = '';
  console.log(`Generating ${num} states...`);
  for (let i = 0; i < num; i++) {
    const row = createStateRow(i + 1);
    container.appendChild(row);
  }
  updateVisibility();
}

function createStateRow(index) {
  const div = document.createElement('div');
  div.className = 'state-row';
  div.innerHTML = `<h4>‡∏™‡∏†‡∏≤‡∏ß‡∏∞ ${index}</h4><div class="vars-container"></div>`;
  const varsContainer = div.querySelector('.vars-container');
  allVars.forEach(key => {
    const group = document.createElement('div');
    group.className = 'var-group';
    const label = document.createElement('label');
    label.textContent = varLabels[key] || key;
    const input = document.createElement('input');
    input.type = 'number';
    input.id = `state${index}_${key}`;
    input.step = 'any';
    input.value = '';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = `eq${index}_${key}`;
    checkbox.onchange = function() {
      if (this.checked) {
        input.value = '=';
        input.disabled = true;
      } else {
        input.value = '';
        input.disabled = false;
      }
    };
    input.oninput = function() {
      const eq = document.getElementById(`eq${index}_${key}`);
      if (this.value !== '' && this.value !== '=') {
        eq.checked = false;
      }
    };
    group.appendChild(label);
    group.appendChild(input);
    group.appendChild(checkbox);
    varsContainer.appendChild(group);
  });
  return div;
}

function updateVisibility() {
  const system = document.getElementById('system').value;
  const isSpring = system === 'spring';
  console.log(`Updating visibility for ${system}`);
  allVars.forEach(key => {
    for (let i = 1; i <= currentNumStates; i++) {
      const input = document.getElementById(`state${i}_${key}`);
      const group = input ? input.parentElement : null;
      if (group) {
        if ((key === 'k' && !isSpring) || (key === 'L' && isSpring)) {
          group.classList.add('hidden');
        } else {
          group.classList.remove('hidden');
        }
      }
    }
  });
}

function loadExample(name) {
  console.log(`Loading example: ${name}`);
  let system, numStates, values;
  if (name === 'spring1') {
    system = 'spring'; numStates = 2;
    values = [
      {m: 2, x: 0.1, g: 9.81},
      {m: 0.5, x: '='}
    ];
  } else if (name === 'spring2') {
    system = 'spring'; numStates = 2;
    values = [
      {m: 0.05, x: 0.02, g: 9.81},
      {m: '=', A: 0.025, x: 0}
    ];
  } else { // pendulum1
    system = 'pendulum'; numStates = 2;
    values = [
      {L: 2, T: 2.5, g: 9.81},
      {L: 8, T: '='}
    ];
  }
  document.getElementById('system').value = system;
  document.getElementById('numStates').value = numStates;
  generateStates();
  for (let i = 0; i < numStates; i++) {
    const state = values[i];
    for (let key in state) {
      const inputId = `state${i+1}_${key}`;
      const input = document.getElementById(inputId);
      const eqId = `eq${i+1}_${key}`;
      const eq = document.getElementById(eqId);
      if (state[key] === '=') {
        input.value = '=';
        eq.checked = true;
        input.disabled = true;
      } else {
        input.value = state[key];
        eq.checked = false;
        input.disabled = false;
      }
    }
  }
  updateVisibility();
  setTimeout(calculate, 100); // ‡∏£‡∏≠ DOM update
}

function clearAll() {
  console.log('Clearing all...');
  document.getElementById('system').value = 'spring';
  document.getElementById('numStates').value = '2';
  generateStates();
  document.getElementById('result').style.display = 'none';
  document.getElementById('plots').innerHTML = '';
  document.getElementById('plots').style.display = 'none';
}

function addState() {
  if (currentNumStates < 4) {
    document.getElementById('numStates').value = ++currentNumStates;
    generateStates();
  }
}

function removeLastState() {
  if (currentNumStates > 1) {
    document.getElementById('numStates').value = --currentNumStates;
    generateStates();
  }
}

function collectData() {
  const system = document.getElementById('system').value;
  const states = [];
  for (let i = 1; i <= currentNumStates; i++) {
    const state = {};
    allVars.forEach(key => {
      const input = document.getElementById(`state${i}_${key}`);
      if (input) {
        const val = input.value.trim();
        if (val !== '' && val !== '=') {
          const num = parseFloat(val);
          if (!isNaN(num)) state[key] = num;
        } else if (val === '=') {
          state[key] = '=';
        }
      }
    });
    states.push(state);
  }
  return {system, states};
}

function exportJson() {
  const payload = collectData();
  alert('JSON Payload:\n' + JSON.stringify(payload, null, 2));
}
