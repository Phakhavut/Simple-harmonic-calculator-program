<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SHM Calculator</title>
<style>
  body { font-family: Arial; margin: 20px; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  input { width: 60px; text-align: center; }
</style>
</head>
<body>
<h2>SHM Calculator</h2>

<form id="shmForm">
  <table id="shmTable">
    <thead>
      <tr>
        <th>m</th>
        <th>k / L</th>
        <th>x</th>
        <th>v</th>
        <th>a</th>
        <th>Vmax</th>
        <th>a_max</th>
        <th>KE</th>
        <th>PE</th>
        <th>E</th>
        <th>A</th>
        <th>ω</th>
        <th>f</th>
        <th>T</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input name="m" value="1"></td>
        <td><input name="k" value="10"></td>
        <td><input name="x" value="0.1"></td>
        <td><input name="v" value="0"></td>
        <td><input name="a" value="="></td>
        <td><input name="Vmax" value="="></td>
        <td><input name="a_max" value="="></td>
        <td><input name="KE" value="="></td>
        <td><input name="PE" value="="></td>
        <td><input name="E" value="="></td>
        <td><input name="A" value="="></td>
        <td><input name="omega" value="="></td>
        <td><input name="f" value="="></td>
        <td><input name="T" value="="></td>
      </tr>
      <tr>
        <td><input name="m" value="2"></td>
        <td><input name="k" value="20"></td>
        <td><input name="x" value="0.2"></td>
        <td><input name="v" value="="></td>
        <td><input name="a" value="="></td>
        <td><input name="Vmax" value="="></td>
        <td><input name="a_max" value="="></td>
        <td><input name="KE" value="="></td>
        <td><input name="PE" value="="></td>
        <td><input name="E" value="="></td>
        <td><input name="A" value="="></td>
        <td><input name="omega" value="="></td>
        <td><input name="f" value="="></td>
        <td><input name="T" value="="></td>
      </tr>
    </tbody>
  </table>
  <br>
  <button type="button" onclick="calculate()">Calculate</button>
</form>

<script>
async function calculate() {
    const rows = document.querySelectorAll("#shmTable tbody tr");
    const states = [];

    rows.forEach(row => {
        const state = {};
        row.querySelectorAll("input").forEach(input => {
            state[input.name] = input.value;
        });
        states.push(state);
    });

    // เรียก API Python (สมมติใช้ fetch / Flask)
    const response = await fetch("/calculate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ system: "spring", states: states })
    });
    const data = await response.json();

    // แสดงผลลัพธ์
    rows.forEach((row, i) => {
        row.querySelectorAll("input").forEach(input => {
            input.value = data[i][input.name] !== null ? Number(data[i][input.name].toFixed(4)) : "=";
        });
    });
}
</script>
</body>
</html>
