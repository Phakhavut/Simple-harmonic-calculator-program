<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<title>Simple-harmonic-calculator-program</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:18px;background:#f7f9fb;color:#111}
  h1{margin-bottom:6px}
  .box{background:white;padding:12px;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,0.08);margin-bottom:14px}
  h3{margin-top:0}
  label{display:inline-block;width:140px;font-weight:bold;font-size:0.9em}
  input[type="text"]{width:70px;padding:4px;border:1px solid #ddd;border-radius:4px;margin-right:4px}
  button{padding:8px 12px;margin:4px;background:#1677ff;color:white;border:none;border-radius:6px;cursor:pointer}
  button:hover{background:#0d5eff}
  .state-row{margin-bottom:12px;padding:10px;border:1px solid #e6eef6;border-radius:6px;background:#f9fcff}
  .state-row h4{margin:0 0 8px 0;font-size:1.1em}
  .vars-container{display:flex;flex-wrap:wrap}
  .var-group{display:inline-block;margin:4px 6px;vertical-align:top;min-width:160px}
  .warning{color:#b91c1c;font-weight:700}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  td,th{border:1px solid #e6eef6;padding:6px;text-align:left}
  th{background:#f0f8ff}
  #result{display:none}
  select{width:120px;padding:4px}
  .hidden{display:none !important}
</style>
</head>
<body>
  <h1>Simple-harmonic-calculator-program</h1>

  <div class="box">
    <h3>üîß ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</h3>
    <button onclick="alert('1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (‡∏™‡∏õ‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏π‡∏Å‡∏ï‡∏∏‡πâ‡∏°)\n2. ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏ô‡∏™‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏î‡∏µ‡∏¢‡∏ß\n3. ‡∏Å‡∏î \"‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå\n4. ‡∏Å‡∏î \"‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà')">
      ‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    </button>
    <button onclick="clearAll()">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  </div>

  <div class="box">
    <h3>üìù ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
    <div>
      <label>‡∏£‡∏∞‡∏ö‡∏ö:</label>
      <select id="system" onchange="updateVisibility()">
        <option value="spring">‡∏™‡∏õ‡∏£‡∏¥‡∏á (Spring)</option>
        <option value="pendulum">‡∏•‡∏π‡∏Å‡∏ï‡∏∏‡πâ‡∏° (Pendulum)</option>
      </select>
    </div>

    <div id="statesContainer"></div>

    <br>
    <button onclick="calculate()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
  </div>

  <div id="result" class="box"></div>

<script>
const varLabels = {
  m: '‡∏°‡∏ß‡∏• m (kg)', k: '‡∏™‡∏õ‡∏£‡∏¥‡∏á k (N/m)', L: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß L (m)', g: '‡πÅ‡∏£‡∏á‡πÇ‡∏ô‡πâ‡∏°‡∏ñ‡πà‡∏ß‡∏á g (m/s¬≤)',
  x: '‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏±‡∏î x (m)', v: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß v (m/s)', a: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á a (m/s¬≤)',
  Vmax: 'Vmax (m/s)', a_max: 'a_max (m/s¬≤)', A: '‡πÅ‡∏≠‡∏°‡∏û‡∏•‡∏¥‡∏à‡∏π‡∏î A (m)',
  omega: 'œâ (rad/s)', f: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà f (Hz)', T: '‡∏Ñ‡∏≤‡∏ö T (s)',
  E: '‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏° E (J)', KE: '‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏•‡∏ô‡πå KE (J)', PE: '‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏®‡∏±‡∏Å‡∏¢‡πå PE (J)'
};
const allVars = Object.keys(varLabels);

function createStateRow() {
  const div = document.createElement('div');
  div.className = 'state-row';
  div.innerHTML = `<h4>‡∏™‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</h4><div class="vars-container"></div>`;
  const varsContainer = div.querySelector('.vars-container');
  allVars.forEach(key => {
    const group = document.createElement('div');
    group.className = 'var-group';
    const label = document.createElement('label');
    label.textContent = varLabels[key];
    const input = document.createElement('input');
    input.type = 'text';
    input.id = `state1_${key}`;
    group.appendChild(label);
    group.appendChild(input);
    varsContainer.appendChild(group);
  });
  return div;
}

function updateVisibility() {
  const system = document.getElementById('system').value;
  const isSpring = system === 'spring';
  allVars.forEach(key => {
    const input = document.getElementById(`state1_${key}`);
    const group = input ? input.parentElement : null;
    if (group) {
      if ((key === 'k' && !isSpring) || (key === 'L' && isSpring)) {
        group.classList.add('hidden');
      } else {
        group.classList.remove('hidden');
      }
    }
  });
}

function getInputValues() {
  const system = document.getElementById('system').value;
  const state = {};
  allVars.forEach(key => {
    const input = document.getElementById(`state1_${key}`);
    if (input && input.value.trim() !== '') state[key] = input.value.trim();
  });
  return { system, states: [state] };
}

function calculate() {
  const payload = getInputValues();
  fetch('/solve', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    const resultDiv = document.getElementById('result');
    if (data.error) {
      resultDiv.innerHTML = `<p class="warning">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${data.error}</p>`;
    } else {
      let html = `<h3>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (${data.system})</h3>`;
      const s = data.results[0];
      html += `<table><tr>`;
      for (let key of allVars) html += `<th>${varLabels[key]}</th>`;
      html += `</tr><tr>`;
      for (let key of allVars)
        html += `<td>${s[key] !== undefined && s[key] !== null ? s[key].toFixed ? s[key].toFixed(4) : s[key] : ''}</td>`;
      html += `</tr></table>`;
      if (s.warnings && s.warnings.length > 0)
        html += `<p class="warning">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ${s.warnings.join('; ')}</p>`;
      html += `<pre>${s.explanation || ''}</pre>`;
      resultDiv.innerHTML = html;
      resultDiv.style.display = 'block';
    }
  })
  .catch(err => {
    document.getElementById('result').innerHTML = `<p class="warning">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err}</p>`;
  });
}

function clearAll() {
  document.querySelectorAll('input[type="text"]').forEach(i => i.value = '');
  document.getElementById('result').style.display = 'none';
}

document.getElementById('statesContainer').appendChild(createStateRow());
updateVisibility();
</script>
</body>
</html>
